<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>Time Sniper: 世紀を撃ち抜け！</title>
    <style>
        body {
            font-family: sans-serif;
            background: #1f2a36;
            color: white;
            text-align: center;
            padding: 40px;
        }

        .event {
            font-size: 32px;
            color: #ffcc66;
            margin: 20px 0;
        }

        .choices {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .choice {
            background: #2c3e50;
            border: 2px dashed #999;
            padding: 15px 30px;
            font-size: 24px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .choice:hover {
            background: #34495e;
        }

        .score,
        .timer {
            font-size: 20px;
            margin: 10px;
        }

        #feedback {
            font-size: 24px;
            margin: 20px;
        }

        #retryButton button {
            font-size: 20px;
            padding: 10px 20px;
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <h1>Time Sniper: 世紀を撃ち抜け！</h1>
    <div class="score">スコア: <span id="score">0</span></div>
    <div class="timer">残り時間: <span id="timer">30</span>秒</div>
    <div>この出来事は何世紀？</div>
    <div class="event" id="event">----</div>
    <div class="choices" id="choices"></div>
    <div id="feedback"></div>
    <div id="wrongList"></div>
    <div id="retryButton"></div>

    <script>
        const questions = [
            { event: "仏教伝来", year: 538 }, { event: "聖徳太子が摂政に就任", year: 593 },
            { event: "十七条憲法制定", year: 604 }, { event: "大化の改新", year: 645 },
            { event: "大宝律令制定", year: 701 }, { event: "平城京遷都", year: 710 },
            { event: "墾田永年私財法", year: 743 }, { event: "平安京遷都", year: 794 },
            { event: "遣唐使廃止", year: 894 }, { event: "古今和歌集編纂", year: 905 },
            { event: "白河上皇の院政開始", year: 1086 }, { event: "保元の乱", year: 1156 },
            { event: "平治の乱", year: 1159 }, { event: "源平合戦の始まり", year: 1180 },
            { event: "壇ノ浦の戦い・平氏滅亡", year: 1185 }, { event: "源頼朝が征夷大将軍に任命", year: 1192 },
            { event: "承久の乱", year: 1221 }, { event: "御成敗式目制定", year: 1232 },
            { event: "文永の役", year: 1274 }, { event: "弘安の役", year: 1281 },
            { event: "鎌倉幕府滅亡", year: 1333 }, { event: "建武の新政開始", year: 1334 },
            { event: "南北朝合一", year: 1392 }, { event: "応仁の乱", year: 1467 },
            { event: "鉄砲伝来", year: 1543 }, { event: "キリスト教伝来", year: 1549 },
            { event: "長篠の戦い", year: 1575 }, { event: "本能寺の変", year: 1582 },
            { event: "小田原征伐", year: 1590 }, { event: "文禄の役", year: 1592 },
            { event: "関ヶ原の戦い", year: 1600 }, { event: "江戸幕府成立", year: 1603 },
            { event: "武家諸法度（参勤交代）", year: 1635 }, { event: "鎖国完成", year: 1639 },
            { event: "享保の改革", year: 1716 }, { event: "寛政の改革", year: 1787 },
            { event: "大塩平八郎の乱", year: 1837 }, { event: "天保の改革", year: 1841 },
            { event: "ペリー来航", year: 1853 }, { event: "日米和親条約", year: 1854 },
            { event: "廃藩置県", year: 1871 }, { event: "徴兵令・地租改正・学制", year: 1873 },
            { event: "大日本帝国憲法公布", year: 1889 }, { event: "第一回帝国議会／教育勅語", year: 1890 },
            { event: "日清戦争", year: 1894 }, { event: "日露戦争", year: 1904 },
            { event: "韓国併合", year: 1910 }, { event: "関税自主権の完全回復", year: 1911 },
            { event: "第一次世界大戦参戦", year: 1914 }, { event: "米騒動／原敬内閣", year: 1918 },
            { event: "関東大震災", year: 1923 }, { event: "普通選挙法・治安維持法", year: 1925 },
            { event: "満州事変", year: 1931 }, { event: "日中戦争", year: 1937 },
            { event: "太平洋戦争開戦", year: 1941 }, { event: "ポツダム宣言受諾／敗戦", year: 1945 },
            { event: "日本国憲法公布", year: 1946 }, { event: "教育基本法／地方自治法／労働基準法", year: 1947 },
            { event: "サンフランシスコ講和条約", year: 1951 }, { event: "国連加盟", year: 1956 },
            { event: "東海道新幹線開通", year: 1964 }, { event: "沖縄返還", year: 1972 },
            { event: "昭和天皇崩御→平成へ", year: 1989 }, { event: "阪神・淡路大震災／地下鉄サリン事件", year: 1995 },
            { event: "東日本大震災／福島原発事故", year: 2011 }
        ];

        let score = 0;
        let timer = 30;
        let current;
        const wrongAnswers = [];
        let timerInterval;
        let correctStreak = 0;
        let inBonusTime = false;

        const scoreEl = document.getElementById('score');
        const timerEl = document.getElementById('timer');
        const eventEl = document.getElementById('event');
        const choicesEl = document.getElementById('choices');
        const feedbackEl = document.getElementById('feedback');
        const wrongListEl = document.getElementById('wrongList');
        const retryButtonEl = document.getElementById('retryButton');

        function getCentury(year) {
            return Math.floor((year - 1) / 100) + 1;
        }

        function generateChoices(correct) {
            const options = new Set([correct]);
            while (options.size < 4) {
                const candidate = correct + Math.floor(Math.random() * 8 - 4);
                if (candidate > 0) options.add(candidate);
            }
            return Array.from(options).sort(() => Math.random() - 0.5);
        }

        function showFeedback(text, isCorrect) {
            feedbackEl.textContent = text;
            feedbackEl.style.color = isCorrect ? 'lightgreen' : 'red';
            setTimeout(() => {
                feedbackEl.textContent = '';
            }, 1000);
        }

        function nextQuestion() {
            if (inBonusTime) return;
            current = questions[Math.floor(Math.random() * questions.length)];
            eventEl.textContent = current.event;
            const correct = getCentury(current.year);
            const options = generateChoices(correct);
            choicesEl.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('div');
                btn.textContent = `${opt}世紀`;
                btn.className = 'choice';
                btn.onclick = () => {
                    if (opt === correct) {
                        score++;
                        correctStreak++;
                        showFeedback('正解！', true);
                        if (correctStreak >= 5) {
                            startBonusTime();
                            return;
                        }
                    } else {
                        score = Math.max(0, score - 1);
                        correctStreak = 0;
                        wrongAnswers.push({
                            event: current.event,
                            correct: `${correct}世紀`,
                            selected: `${opt}世紀`
                        });
                        showFeedback('残念…', false);
                    }
                    scoreEl.textContent = score;
                    nextQuestion();
                };
                choicesEl.appendChild(btn);
            });
        }

        function startBonusTime() {
            inBonusTime = true;
            clearInterval(timerInterval);
            correctStreak = 0;

            const targetCentury = Math.floor(Math.random() * 15) + 6;
            eventEl.textContent = `\u30dc\u30fc\u30ca\u30b9\u30bf\u30a4\u30e0\uff01${targetCentury}世紀の出来事を選べ！`;
            choicesEl.innerHTML = '';

            const shuffled = questions.sort(() => Math.random() - 0.5).slice(0, 20);
            shuffled.forEach(q => {
                const btn = document.createElement('div');
                btn.textContent = q.event;
                btn.className = 'choice';
                btn.onclick = () => {
                    const century = getCentury(q.year);
                    if (century === targetCentury) {
                        score++;
                        showFeedback('正解！', true);
                        btn.remove(); // 正解だったら選択肢を削除
                    } else {
                        score = Math.max(0, score - 1);
                        showFeedback('残念…', false);
                    }
                    scoreEl.textContent = score;
                };
                choicesEl.appendChild(btn);
            });

            setTimeout(() => {
                inBonusTime = false;
                correctStreak = 0;
                nextQuestion();
                startTimer();
            }, 5000);
        }

        function showWrongAnswers() {
            if (wrongAnswers.length === 0) {
                wrongListEl.innerHTML = "<h2>全問正解！素晴らしい！</h2>";
            } else {
                wrongListEl.innerHTML = "<h2>間違えた問題一覧：</h2><ul>" +
                    wrongAnswers.map(w =>
                        `<li>${w.event}：正解 → ${w.correct} ／ あなたの答え → ${w.selected}</li>`
                    ).join('') + "</ul>";
            }

            const retryBtn = document.createElement('button');
            retryBtn.textContent = "もう一度挑戦";
            retryBtn.onclick = restartGame;
            retryButtonEl.innerHTML = '';
            retryButtonEl.appendChild(retryBtn);
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timer--;
                timerEl.textContent = timer;
                if (timer <= 0) {
                    clearInterval(timerInterval);
                    eventEl.textContent = '終了！';
                    choicesEl.innerHTML = '';
                    showWrongAnswers();
                }
            }, 1000);
        }

        function restartGame() {
            score = 0;
            timer = 30;
            correctStreak = 0;
            inBonusTime = false;
            wrongAnswers.length = 0;
            scoreEl.textContent = score;
            timerEl.textContent = timer;
            eventEl.textContent = '';
            feedbackEl.textContent = '';
            wrongListEl.innerHTML = '';
            retryButtonEl.innerHTML = '';
            nextQuestion();
            startTimer();
        }

        nextQuestion();
        startTimer();
    </script>
</body>

</html>